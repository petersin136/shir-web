name: Supabase Auto-Ping (Prevent Pause)

on:
  schedule:
    # ë§¤ì£¼ ì›”ìš”ì¼, ëª©ìš”ì¼ ì˜¤ì „ 9ì‹œ(UTC) ì‹¤í–‰
    - cron: '0 9 * * 1,4'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase Database
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          echo "ğŸš€ Starting Supabase ping..."
          
          if [ -z "$SUPABASE_URL" ] || [ -z "$SUPABASE_ANON_KEY" ]; then
            echo "âŒ Error: SUPABASE_URL or SUPABASE_ANON_KEY is not set in GitHub Secrets"
            exit 1
          fi
          
          echo "ğŸ“¡ Sending GET request to Supabase REST API..."
          echo "URL: $SUPABASE_URL/rest/v1/contact_messages?select=id&limit=1"
          
          HTTP_CODE=$(curl -s -o /tmp/response.json -w "%{http_code}" \
            -X GET \
            -H "apikey: $SUPABASE_ANON_KEY" \
            -H "Authorization: Bearer $SUPABASE_ANON_KEY" \
            -H "Content-Type: application/json" \
            -H "Prefer: return=minimal" \
            "$SUPABASE_URL/rest/v1/contact_messages?select=id&limit=1")
          
          echo "ğŸ“Š HTTP Status Code: $HTTP_CODE"
          
          if [ "$HTTP_CODE" -ge 200 ] && [ "$HTTP_CODE" -lt 300 ]; then
            echo "âœ… Success! Supabase database is active."
            echo "Response:"
            cat /tmp/response.json
            echo ""
          else
            echo "âŒ Error: HTTP $HTTP_CODE"
            echo "Response body:"
            cat /tmp/response.json
            echo ""
            exit 1
          fi
          
          echo "âœ¨ Ping completed successfully!"

